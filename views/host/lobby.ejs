<!DOCTYPE html>
<html>
  <%- include('../partials/header', {title}); %>
  <body>
    <h1><%= title %></h1>
    <button id="cancel" type="button" class="btn btn-warning">Cancel Game</button>
    <h2 id="title">Join this Game using the Game Pin:</h2>
    <h1 id="gamePinText"></h1>
    <textarea style="width: 700px; height: 500px" readonly id="players"></textarea>
    <br />
    <button id="start" type="button" class="btn btn-success" onclick="startGame()">Start Game</button>
    <br />
    <br />
    <%- include('../partials/footer') %>
    <script>
      const socket = io({ transports: ['websocket'], upgrade: false });
      //var params = jQuery.deparam(window.location.search);
      const urlParams = new URLSearchParams(window.location.search);
      
      // const params = {
      //   id: urlParams.get('quizId'),
      // };
      const params = {
        id: window.location.href.split("/lobby/")[1]
      };
      //When host connects to server
      socket.on('connect', function () {
        document.getElementById('players').value = '';

        //Tell server that it is host connection
        console.log(params, 'params');
        socket.emit('host-join', params);
      });

      socket.on('showGamePin', function (data) {
        console.log(data, 'id');
        document.getElementById('gamePinText').innerHTML = data.pin;
      });

      //Adds player's name to screen and updates player count
      socket.on('updatePlayerLobby', function (data) {
        console.log("data!!!!!!!!!!!!",data);
        document.getElementById('players').value = '';

        for (var i = 0; i < data.length; i++) {
          console.log(data);
          document.getElementById('players').value += data[i].name + '\n';
        }
      });

      //Tell server to start game if button is clicked
      function startGame(e) {
        socket.emit('startGame');
      }
      function endGame() {
        window.location.href = '/';
      }

      //When server starts the game
      socket.on('gameStarted', function (id) {
        console.log('Game Started!');
        window.location.href = '/gameblock' + '?id=' + id;
      });

      // socket.on('noGameFound', function () {
      //   window.location.href = '../../'; //Redirect user to 'join game' page
      // });
    </script>
  </body>
</html>
